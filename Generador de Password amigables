// Este complemento de Hojas de Cálculo de Google genera contraseñas para niños inspiradas en DinoPass de Codemoji.

var adjectives = ["tall","short","young","old","pretty","big","small","nice","kind","brave","funny","calm","proud","silly","happy","cute","clean","flat","round","wide","tiny","loud","quiet","red","orange","green","blue","yellow","purple","gray","pink","odd","rich","jolly","low","cold","cool","dry"];

var nouns = ["mall","toy","book","dog","cat","cup","pig","horse","mouse","egg","door","sock","bat","bed","bun","cake","cow","doll","hat","jar","kite","map","bird","clam","desk","dime","fog","hose","joke","rock","seed","snow","star","toe","arm","camp","frog","lock","meal","owl","plot","bunny","song","tiger","wish","hair","pest"];

var numbers_to_avoid = [69, 13]; // ;-)
// Para evitar otros números, agréguelos dentro de los corchetes [] de arriba.
// separar varios números con comas
// ejemplos: var numbers_to_avoid = [69, 420];

var combinations_to_avoid = []; 
// Para evitar otras combinaciones de palabras, agréguelas dentro de los corchetes [] de arriba.
// coloque las palabras entre comillas y sepárelas con comas.
// ejemplo: var combinations_to_avoid = [ "tallcup", "nicehorse", "calmegg" ];

var symbols = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789";
// enumera todas las letras/números/símbolos para elegir en contraseñas aleatorias entre las comillas
// estos solo se utilizan para contraseñas de símbolos aleatorios.


function generateWordPassword(){
  var base;
  do{
    var adjective = adjectives[randomInt(adjectives.length)];
    var noun = nouns[randomInt(nouns.length)];
    base = adjective+noun;
  }
  while(combinations_to_avoid.indexOf(base)!=-1);
  var number;
  do {
  number = Math.floor(Math.random() * 88) + 11;
  }
  while(numbers_to_avoid.indexOf(number)!=-1);

return base+number;
}

// Úselo bajo su propio riesgo: no escala bien y tiene la posibilidad de tropezar con palabras inapropiadas.

// function generateRandomSymbolsPassword(length){
//   var password = "";
//   var avoid = numbers_to_avoid.concat(combinations_to_avoid);
//   var symbolList = symbols.split("");
//   do {
//     for(var i=0; i<length; i++){
//       password+=symbolList[Math.floor(Math.random() * symbolList.length)];
//     }
//   }
//   while(avoid.filter(num => password.indexOf(num) != -1).length > 0);
//   return password;
// }


function fillPasswords(mode='words', args={}) {
  var {length = 8} = args;
  var activeSheet = SpreadsheetApp.getActiveSheet();
  var selection = activeSheet.getActiveRange();
  var used = [];
  for(var i=0; i<selection.getNumRows(); i++){
    for(var j=0; j<selection.getNumColumns(); j++){
      var password;
      do{
        switch(mode){
          case 'symbols':
            password = generateRandomSymbolsPassword(length);
            break;
          case 'words':
          default:
            password = generateWordPassword();
        }
      }
      while(used.indexOf(password)>-1);
      used.push(password);
    selection.getCell(i+1, j+1).setValue(password)
    }
  }
}

function randomInt(max){
  return Math.floor(Math.random() * Math.floor(max));
}


function fillRandomWords() {
  fillPasswords('words');
}

// function fillRandomSymbols() {
//   var ui = SpreadsheetApp.getUi();
//   var prompt = ui.prompt("¿Cuántos caracteres tiene cada contraseña?");
//   if(prompt.getSelectedButton() !== ui.Button.OK){
//     return;
//   }
//   var length = parseInt(prompt.getResponseText()) || 8;
//   fillPasswords('symbols', {length});
// }

function onOpen() {
  var ui = SpreadsheetApp.getUi();
  ui.createAddonMenu()
      .addItem('Crear contraseñas a partir de palabras', 'fillRandomWords')
      // .addItem('Crear contraseñas a partir de símbolos', 'fillRandomSymbols')
      .addToUi();
}
